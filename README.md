# terraform-k8s-cluster/README.md

# Terraform Kubernetes Cluster on AWS EC2

This project provides a Terraform configuration to deploy a self-managed Kubernetes cluster on AWS EC2. The configuration is modular, reusable, and designed for scalability and maintainability.

---

## **Project Structure**

- **`modules/`**: Contains reusable Terraform modules.
  - **`ec2/`**: Module for provisioning EC2 instances.
  - **`vpc/`**: Module for creating a Virtual Private Cloud (VPC).
  - **`security-groups/`**: Module for managing security groups.

- **`environments/`**: Contains environment-specific configurations.
  - **`dev/`**: Development environment configuration.
  - **`staging/`**: Staging environment configuration.
  - **`prod/`**: Production environment configuration.

- **`scripts/`**: Contains scripts for setting up and configuring the Kubernetes cluster.
  - **`install-k8s.sh`**: Script to install Kubernetes on EC2 instances.
  - **`configure-cluster.sh`**: Script to configure the Kubernetes cluster.

- **`main.tf`**: Root Terraform configuration file that ties together all modules and resources.

- **`variables.tf`**: Defines input variables for the project.

- **`outputs.tf`**: Defines outputs for the project.

---

## **Getting Started**

### **Prerequisites**
Ensure you have the following installed and configured:
- [Terraform](https://www.terraform.io/downloads.html) (v1.0 or later)
- AWS CLI with valid credentials configured (`aws configure`)
- SSH key pair for accessing EC2 instances

### **Steps to Deploy**

1. **Clone the Repository**:
   ```bash
   git clone <repository-url>
   cd terraform-k8s-cluster
   ```

2. **Select Environment**:
   Navigate to the desired environment folder (e.g., `environments/dev`):
   ```bash
   cd environments/dev
   ```

3. **Initialize Terraform**:
   Initialize the Terraform working directory:
   ```bash
   terraform init
   ```

4. **Plan the Deployment**:
   Review the resources that will be created:
   ```bash
   terraform plan
   ```

5. **Apply the Configuration**:
   Deploy the infrastructure:
   ```bash
   terraform apply
   ```

6. **Access the Kubernetes Cluster**:
   After deployment, use the `kubectl` configuration file generated by the `configure-cluster.sh` script to access the cluster.

---

## **Modules Documentation**

### **EC2 Module**
- **Path**: `modules/ec2/`
- **Purpose**: Provisions EC2 instances for the Kubernetes master and worker nodes.
- **Key Features**:
  - Supports dynamic scaling of worker nodes.
  - Configurable instance types and AMI IDs.
- **Documentation**: See `modules/ec2/README.md` for detailed usage.

### **VPC Module**
- **Path**: `modules/vpc/`
- **Purpose**: Creates a Virtual Private Cloud (VPC) with public and private subnets.
- **Key Features**:
  - Supports multiple availability zones.
  - Automatically provisions NAT Gateways and Internet Gateways.
- **Documentation**: See `modules/vpc/README.md` for detailed usage.

### **Security Groups Module**
- **Path**: `modules/security-groups/`
- **Purpose**: Manages security groups for the Kubernetes cluster.
- **Key Features**:
  - Configurable ingress and egress rules.
  - Supports dynamic IP range restrictions.
- **Documentation**: See `modules/security-groups/README.md` for detailed usage.

---

## **Scripts**

### **`install-k8s.sh`**
- **Purpose**: Automates the installation of Kubernetes on EC2 instances.
- **Usage**: This script is executed during the provisioning of EC2 instances.

### **`configure-cluster.sh`**
- **Purpose**: Configures the Kubernetes cluster after installation.
- **Usage**: This script sets up the `kubectl` configuration and initializes the cluster.

---

## **Outputs**

After deployment, the following outputs will be available:

- **Cluster Endpoint**: The API endpoint of the Kubernetes cluster.
- **Node Information**:
  - Public and private IPs of the worker nodes.
  - Instance IDs of the master and worker nodes.
- **VPC Information**:
  - VPC ID
  - Subnet IDs (public and private)
- **Security Group Information**:
  - Security group IDs for the cluster.

---

## **Example Usage**

### **Deploying the Cluster**
```bash
terraform init
terraform plan -var-file=../terraform.tfvars
terraform apply -var-file=../terraform.tfvars
```

### **Scaling Worker Nodes**
To scale the number of worker nodes, update the `worker_count` variable in `terraform.tfvars` and reapply the configuration:
```bash
terraform apply -var-file=../terraform.tfvars
```

---

## **Best Practices**

1. **Security**:
   - Restrict `allowed_ip_ranges` in `terraform.tfvars` to trusted IPs.
   - Use a secure SSH key pair for accessing EC2 instances.

2. **Cost Management**:
   - Use appropriate instance types for your workload to avoid unnecessary costs.
   - Monitor NAT Gateway usage if private subnets are used.

3. **Environment Isolation**:
   - Use separate environments (`dev`, `staging`, `prod`) to isolate resources and configurations.

---

## **License**

This project is licensed under the MIT License. See the `LICENSE` file for details.

---

## **Contributing**

Contributions are welcome! Please open an issue or submit a pull request for any improvements or bug fixes.

---

## **Contact**

For questions or support, please contact the project owner at `team-name@example.com`.
